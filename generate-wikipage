#!/usr/bin/env node
"use strict";

const fs = require("fs/promises");
const path = require("path");

console.log(
  `This page is generated by \`${path.basename(process.argv[1])}\`. Do not edit it directly.`
);
console.log("");

async function countChar(dirname) {
  const dir = await fs.opendir(dirname);
  console.log(`<table>`);
  console.log(`<tr><th>filename</th><th># of chars</th></tr>`);
  while (true) {
    const dirent = await dir.read();
    if (dirent != null) {
      if (!/^\./.test(dirent.name) && /\.md$/.test(dirent.name)) {
        const filename = `${dirname}/${dirent.name}`;
        const content = await fs.readFile(filename);
        let len = 0;
        for (let _ of content.toString("utf-8")) {
          len++;
        }
        console.log(`<tr><td>${filename}</td><td>${len}</td></tr>`);
      }
    } else {
      break;
    }
  }
  console.log("</table>");
  await dir.close();
}

countChar(".");
